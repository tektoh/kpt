
<html>
  <head>
    <title>KPT</title>
    <link href="http://maxcdn.bootstrapcdn.com/bootswatch/3.3.1/cerulean/bootstrap.min.css" rel="stylesheet">
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="http://code.jquery.com/jquery-2.1.3.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
    <script src="http://www.parsecdn.com/js/parse-1.3.3.min.js"></script>
    <script src="js/config.js"></script>
    <script>
    $(document).ready(function() {
      var currentUser = Parse.User.current();
      if (!currentUser) {
        location.href = 'login.html';
        return false;
      }

      $('#logoutButton').on('click', function() {
        Parse.User.logOut();
        location.href = 'login.html';
      });

      $('#newButton').on('click', function() {
        var Kpt = Parse.Object.extend("Kpt");
        var kpt = new Kpt();
        kpt.set('createdBy', currentUser);
        kpt.set('title', $('#inputTitle').val());
        kpt.save(null, {
          success: function() {
            render();
          },
          error: function(kpt, error) {
            alert('Failed to create new object, with error code: ' + error.message);
          }
        });
      });

      return render();

      function render() {
        var Kpt = Parse.Object.extend("Kpt");
        var query = new Parse.Query(Kpt);
        query.addDescending('createdAt');
        query.find({
          success: function(results) {
            $('#kptList').html('');
            for (var i = 0; i < results.length; i++) {
              var kpt = results[i];
              $('#kptList').append(
                '<li class="list-group-item">' +
                  '<h3><a href="kpt.html?id=' + kpt.id + '">' + kpt.get('title') + '</a></h3>' +
                  kpt.createdAt +
                '</li>'
              );
            }
          },
          error: function(error) {
            alert("Error: " + error.code + " " + error.message);
          }
        });
      }
    });
    </script>
  </head>
  <body>
    <div class="container">

      <div class="pull-right">
        <button id="logoutButton" type="submit" class="btn btn-link">Logout</button>
      </div>

      <div class="page-header">
        <h1>KPT</h1>
      </div>

      <div>
        <div class="form-group">
          <input type="text" class="form-control" id="inputTitle" placeholder="Enter KPT title">
        </div>
        <button id="newButton" type="submit" class="btn btn-primary">New KPT</button>
      </div>

      <hr>

      <ul id="kptList" class="list-group"></ul>

    </div>
  </body>
</html>
